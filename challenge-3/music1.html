<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Visualization - Circular</title>
  <style>
    body {
      background-color: black;
    }

    #visualization {
      width: 400px;
      height: 400px;
      margin: 50px auto;
      position: relative;
    }

    .circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid white;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <h1>Audio Visualization - Circular (Pony by Ginuwine)</h1>
  <div id="visualization"></div>
  <button id="playButton">Play Audio</button>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = audioCtx.createAnalyser();
    let audioSource;

    const visualizationContainer = d3.select('#visualization');
    const svg = visualizationContainer
      .append('svg')
      .attr('width', '100%')
      .attr('height', '100%');

    const numCircles = 10;
    const circleRadii = d3.range(numCircles).map((_, i) => (i + 1) * 20);

    const circles = svg
      .selectAll('.circle')
      .data(circleRadii)
      .enter()
      .append('circle')
      .attr('class', 'circle')
      .attr('cx', '50%')
      .attr('cy', '50%')
      .attr('r', d => d)
      .style('fill', 'none')
      .style('stroke', 'white')
      .style('stroke-width', '2px');

    const frequencyData = new Uint8Array(analyser.frequencyBinCount);

    function renderVisualization() {
      requestAnimationFrame(renderVisualization);

      analyser.getByteFrequencyData(frequencyData);

      circles.attr('r', (d, i) => d + frequencyData[i] / 3);
      circles.style('stroke', (_, i) => `rgb(${frequencyData[i]}, 255, 255)`);
    }

    function handlePlay() {
      if (!audioSource) {
        const audioElement = new Audio('../music/Ginuwine-Pony.mp3');
        audioSource = audioCtx.createMediaElementSource(audioElement);
        audioSource.connect(analyser);
        analyser.connect(audioCtx.destination);
        audioElement.play();
        renderVisualization();
      }
    }

    const playButton = document.getElementById('playButton');
    playButton.addEventListener('click', handlePlay);
  </script>
</body>
</html>